{erl_opts, [
    debug_info,
    {i, "include"},
    warnings_as_errors
]}.

{deps, []}.

%% Rust NIF compilation
{pre_hooks, [
    {"(linux|darwin|solaris)", compile, "cargo build --release --manifest-path native/Cargo.toml"},
    {"win32", compile, "cargo build --release --manifest-path native\\Cargo.toml"}
]}.

{post_hooks, [
    {"(linux|darwin|solaris)", compile, "sh -c 'mkdir -p priv && cp native/target/release/libfaber_nn_nifs.* priv/ 2>/dev/null || true'"},
    {"win32", compile, "cmd /c if not exist priv mkdir priv && copy native\\target\\release\\faber_nn_nifs.dll priv\\"}
]}.

%% Project plugins
{project_plugins, [
    rebar3_hex,
    rebar3_ex_doc
]}.

%% Test configuration
{eunit_opts, [verbose]}.
{eunit_compile_opts, [{src_dirs, ["src", "test/unit"]}]}.
{cover_enabled, true}.

%% Dialyzer configuration
{dialyzer, [
    {warnings, [unmatched_returns, error_handling, unknown]},
    {plt_apps, top_level_deps}
]}.

%% Documentation with ex_doc
{ex_doc, [
    {extras, [
        {"README.md", #{title => "README"}},
        {"CHANGELOG.md", #{title => "Changelog"}},
        {"LICENSE", #{title => "License"}}
    ]},
    {main, "README.md"},
    {source_url, "https://github.com/rgfaber/faber-nn-nifs"},
    {prefix_ref_vsn_with_v, false}
]}.

%% Hex.pm package metadata
{hex, [
    {doc, #{provider => ex_doc}},
    {files, [
        "src",
        "include",
        "native",
        "rebar.config",
        "rebar.lock",
        "README.md",
        "CHANGELOG.md",
        "LICENSE"
    ]}
]}.

%% Profiles
{profiles, [
    {test, [
        {erl_opts, [debug_info, nowarn_export_all]},
        {extra_src_dirs, ["test/unit"]}
    ]}
]}.
